<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <template id="report_saleorder_document" inherit_id="sale.report_saleorder_document">
            <xpath expr="//tbody[@class='sale_tbody']" position="replace">

                <tbody class="sale_tbody">

                    <t t-foreach="doc.get_model_lines()" t-as="m">

                        <tr t-foreach="m['models']" t-as="l">
                            <td>
                                <span t-esc="l['name']"/>
                            </td>
                            <td class="text-right">
                                <span t-esc="'%.0f'%l['total_quantity']"/>
                                <!--<span groups="product.group_uom" t-field="l.product_uom"/>-->
                            </td>
                            <td class="text-right">
                                <span t-esc="l['price_unit']"
                                      t-esc-options='{"widget": "monetary", "display_currency": "doc.pricelist_id.currency_id"}'/>
                            </td>
                            <t t-if="True in [l.discount &gt; 0.0 for l in doc.order_line]">
                                <td class="text-right" groups="sale.group_discount_per_so_line">
                                    <span t-esc="'%.2f'%l['discount']"/>
                                </td>
                            </t>
                            <td class="text-right">
                                <span t-esc="l['taxes']"/>
                            </td>
                            <td class="text-right total_price_marker_td">
                                <span t-esc="l['total_price']"
                                      t-esc-options='{"widget": "monetary", "display_currency": "doc.pricelist_id.currency_id"}'/>
                            </td>
                        </tr>
                    </t>

                    <t t-foreach="doc.order_line" t-as="l">
                        <t t-if="not l.ad_is_model_variant">
                            <tr>
                                <td>
                                    <span t-field="l.name"/>
                                </td>
                                <td>
                                    <span t-esc="', '.join(map(lambda x: x.name, l.tax_id))"/>
                                </td>
                                <td class="text-right">
                                    <span t-field="l.product_uom_qty"/>
                                    <span groups="product.group_uom" t-field="l.product_uom"/>
                                </td>
                                <td class="text-right">
                                    <span t-field="l.price_unit"/>
                                </td>
                                <t t-if="True in [l.discount &gt; 0.0 for l in doc.order_line]">
                                    <td class="text-right" groups="sale.group_discount_per_so_line">
                                        <span t-field="l.discount"/>
                                    </td>
                                </t>
                                <td class="text-right">
                                    <span t-field="l.price_subtotal"
                                          t-field-options='{"widget": "monetary", "display_currency": "doc.pricelist_id.currency_id"}'/>
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>

            </xpath>

            <xpath expr="//div[@class='page']" position="inside">
                <p class="pagebreak"></p>

                <t t-foreach="doc.get_model_lines()" t-as="bar">
                    <div class="row prevent-page-break" t-foreach="bar['models']" t-as="model">

                        <table class="table table-bordered no-bottom-margin">
                            <thead>
                                <tr>
                                    <th width="12%">Name</th>
                                    <th colspan="100">
                                        <span t-esc="model['name']"/>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td rowspan="3" width="12%">
                                        <image t-attf-src="data:image/png;base64,{{ model['image'] }}"/>
                                    </td>
                                    <td width="22%">
                                        Total quantity
                                    </td>
                                    <td width="22%" class="text-right">
                                        <t t-if="model['total_quantity'] &lt;&gt; 0.0">
                                            <span t-esc="'%.0f'%model['total_quantity']"/>
                                        </t>
                                    </td>
                                    <td width="22%" id="empty_cell_one_name">
                                    </td>
                                    <td width="22%" id="empty_cell_one_value">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Unit price
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="model['price_unit']"
                                              t-esc-options='{"widget": "monetary", "display_currency": "doc.pricelist_id.currency_id"}'/>
                                    </td>
                                    <td id="empty_cell_two_name">
                                    </td>
                                    <td id="empty_cell_two_value">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Total price
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="model['total_price']"
                                              t-esc-options='{"widget": "monetary", "display_currency": "doc.pricelist_id.currency_id"}'/>
                                    </td>
                                    <td id="empty_cell_three_name">
                                    </td>
                                    <td id="empty_cell_three_value">
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="table table-bordered" style="table-layout: fixed; border-top:transparent 0px;">
                            <thead>
                                <tr>
                                    <th t-foreach="bar['values']" t-as="value" class="text-center">
                                        <span t-esc="value['name']"/>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="height: 40px;">
                                    <t t-foreach="model['products']" t-as="product">
                                        <td t-if="not product.get('id', False)" class="hatch"/>
                                        <td t-if="product.get('id', False)" class="text-center">
                                            <t t-if="product['quantity'] &lt;&gt; 0.0">
                                                <span t-esc="'%.0f'%product['quantity']"/>
                                            </t>
                                        </td>
                                    </t>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </t>

            </xpath>

        </template>
    </data>
</openerp>