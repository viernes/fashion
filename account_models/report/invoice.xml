<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <template id="report_invoice_document" inherit_id="account.report_invoice_document">
            <!-- <xpath expr="//tbody[@class='invoice_tbody']/parent::table/thead/tr/th[@groups='sale.group_discount_per_so_line']" position="replace">
                <t t-if="True in [l.discount &gt; 0 for l in o.invoice_line_ids]">
                  <th class="text-right" groups="sale.group_discount_per_so_line">Discount (%)</th>
                </t>
            </xpath> -->
            <xpath expr="//tbody[@class='invoice_tbody']" position="replace">

                <tbody class="invoice_tbody">

                    <t t-foreach="o.get_model_lines()" t-as="m">
                        <t t-foreach="m['models']" t-as="l">
                            <tr>
                                <td class="model_name_marker_td">
                                    <span t-esc="l['name']"/>
                                </td>
                                <td class="text-right">
                                    <span t-esc="'%.0f'%l['total_quantity']"/>
                                    <!--<span groups="product.group_uom" t-field="l.product_uom"/>-->
                                </td>
                                <td class="text-right">
                                    <span t-esc="l['price_unit']"
                                          t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                </td>
                                <t t-if="True in [l.discount &gt; 0 for l in o.invoice_line_ids]">
                                    <td class="text-right" groups="sale.group_discount_per_so_line">
                                        <span t-esc="'%.2f'%l['discount']"/>
                                    </td>
                                </t>
                                <td class="text-right taxes_price_marker_td">
                                    <span t-esc="l['taxes']"/>
                                </td>
                                <td class="text-right">
                                    <span t-esc="l['total_price']"
                                          t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                </td>
                            </tr>
                        </t>
                    </t>

                    <t t-foreach="o.invoice_line_ids" t-as="l">
                        <t t-if="not l.ad_is_model_variant">
                            <tr t-if="Orig &lt;&gt; l.origin and l.origin">
                                <td colspan="100">
                                    <strong>Source:
                                        <span t-field="l.origin"/>
                                    </strong>
                                </td>
                            </tr>
                            <t t-set="Orig" t-value="l.origin"/>
                            <tr>
                                <td>
                                    <span t-field="l.name"/>
                                </td>
                                <td class="text-right">
                                    <span t-field="l.quantity"/>
                                    <!--<span t-field="l.uos_id" groups="product.group_uos"/>-->
                                </td>
                                <td class="text-right">
                                    <span t-field="l.price_unit"/>
                                </td>
                                <t t-if="True in [l.discount &gt; 0 for l in o.invoice_line_ids]">
                                    <td class="text-right" groups="sale.group_discount_per_so_line">
                                        <span t-field="l.discount"/>
                                    </td>
                                </t>
                                <td class="text-right">
                                    <span t-esc="', '.join(map(lambda x: x.name, l.invoice_line_tax_ids))"/>
                                </td>
                                <td class="text-right">
                                    <span t-field="l.price_subtotal"
                                          t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>

            </xpath>

            <xpath expr="//div[@class='page']" position="inside">
                <p class="pagebreak"></p>

                <t t-foreach="o.get_model_lines()" t-as="bar">
                    <div class="row prevent-page-break" t-foreach="bar['models']" t-as="model">

                        <table class="table table-bordered no-bottom-margin">
                            <thead>
                                <tr>
                                    <th width="12%">Name</th>
                                    <th colspan="100">
                                        <span t-esc="model['name']"/>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td rowspan="3" width="12%">
                                        <image t-attf-src="data:image/png;base64,{{ model['image'] }}"/>
                                    </td>
                                    <td width="22%">
                                        Total quantity
                                    </td>
                                    <td width="22%" class="text-right">
                                        <t t-if="model['total_quantity'] &lt;&gt; 0.0">
                                            <span t-esc="'%.0f'%model['total_quantity']"/>
                                        </t>
                                    </td>
                                    <td width="22%" id="empty_cell_one_name">
                                    </td>
                                    <td width="22%" id="empty_cell_one_value">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Unit price
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="model['price_unit']"
                                              t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                    </td>
                                    <td id="empty_cell_two_name">
                                    </td>
                                    <td id="empty_cell_two_value">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Total price
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="model['total_price']"
                                              t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                    </td>
                                    <td id="empty_cell_three_name">
                                    </td>
                                    <td id="empty_cell_three_value">
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="table table-bordered" style="table-layout: fixed; border-top:transparent 0px;">
                            <thead>
                                <tr>
                                    <th t-foreach="bar['values']" t-as="value" class="text-center">
                                        <span t-esc="value['name']"/>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="height: 40px;">
                                    <t t-foreach="model['products']" t-as="product">
                                        <td t-if="not product.get('id', False)" class="hatch"/>
                                        <td t-if="product.get('id', False)" class="text-center">
                                            <t t-if="product['quantity'] &lt;&gt; 0.0">
                                                <span t-esc="'%.0f'%product['quantity']"/>
                                            </t>
                                        </td>
                                    </t>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </t>

            </xpath>

        </template>
    </data>
</openerp>
